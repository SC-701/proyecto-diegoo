@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h3>Consultar Movimientos de Cuenta</h3>

            <form method="get" class="mb-4">
                <div class="input-group">
                    <input type="text" class="form-control" name="id" placeholder="Ingrese el ID de la cuenta (GUID)"
                           value="@Request.Query["id"]" required>
                    <button class="btn btn-primary" type="submit">Consultar</button>
                </div>
            </form>

            @if (!ViewData.ModelState.IsValid)
            {
                <div class="alert alert-danger">
                    @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                    {
                        <p>@error.ErrorMessage</p>
                    }
                </div>
            }

            @if (Model.movimientos != null && Model.movimientos.Any())
            {
                <h4>Últimos 5 Movimientos</h4>
                <div class="table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Fecha</th>
                                <th>Descripción</th>
                                <th>Monto Original</th>
                                <th>Moneda</th>
                                <th>Monto CRC</th>
                                <th>Tasa Cambio</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var movimiento in Model.movimientos)
                            {
                                <tr>
                                    <td>@movimiento.Fecha.ToString("dd/MM/yyyy HH:mm")</td>
                                    <td>@movimiento.Descripcion</td>
                                    <td class="text-end">
                                        @if (movimiento.MonedaOriginal == "CRC")
                                        {
                                            <text>₡@movimiento.MontoOriginal.ToString("N2")</text>
                                        }
                                        else if (movimiento.MonedaOriginal == "USD")
                                        {
                                            <text>$@movimiento.MontoOriginal.ToString("N2")</text>
                                        }
                                        else
                                        {
                                            <text>€@movimiento.MontoOriginal.ToString("N2")</text>
                                        }
                                    </td>
                                    <td>@movimiento.MonedaOriginal</td>
                                    <td class="text-end">₡@movimiento.MontoCrc.ToString("N2")</td>
                                    <td class="text-end">
                                        @if (movimiento.TasaCambio == 1)
                                        {
                                            <text>N/A</text>
                                        }
                                        else
                                        {
                                            <text>@movimiento.TasaCambio.ToString("F4")</text>
                                        }
                                    </td>
                                    <td>
                                        <span class="badge @(movimiento.Estado ? "bg-success" : "bg-danger")">
                                            @(movimiento.Estado ? "Activo" : "Inactivo")
                                        </span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else if (Request.Query.ContainsKey("id") && ViewData.ModelState.IsValid)
            {
                <div class="alert alert-info">
                    <p>No se encontraron movimientos para la cuenta especificada.</p>
                </div>
            }
        </div>
    </div>
</div>
